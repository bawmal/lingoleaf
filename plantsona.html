<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlantSona - Give Your Plant a Personality | LingoLeaf</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .plant-gradient {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c2c 50%, #7cb342 100%);
        }
        
        .image-preview {
            max-height: 300px;
            object-fit: contain;
        }
        
        .personality-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .personality-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .personality-card.selected {
            border: 3px solid #667eea;
            background: #f0f4ff;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="plant-gradient text-white py-6">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-2xl flex items-center justify-center">
                        <img src="/Logo.jpeg" alt="LingoLeaf" class="w-full h-full object-contain">
                    </div>
                    <div>
                        <h1 class="text-xl sm:text-2xl font-bold">LingoLeaf PlantSona</h1>
                        <p class="text-xs text-green-200 hidden sm:block">AI Plant Personality Generator</p>
                    </div>
                </div>
                <a href="/" class="text-white hover:text-green-200 transition font-medium">‚Üê Back to Home</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
        <!-- Hero Section -->
        <div class="text-center mb-12">
            <h2 class="text-4xl font-bold text-gray-800 mb-4">Let Your Plant Introduce Itself! üé≠</h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                Upload a photo and your plant will tell you its name, where it's from, and exactly how to care for it‚Äîall in its own unique voice!
            </p>
        </div>

        <!-- Upload Form -->
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <form id="plantsonaForm" class="space-y-8">
                <!-- Step 1: Upload Photo -->
                <div>
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">üì∏ Step 1: Upload Your Plant Photo</h3>
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-green-500 transition">
                        <input type="file" id="plantImage" accept="image/*" class="hidden" required>
                        <label for="plantImage" class="cursor-pointer">
                            <div id="uploadPrompt">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <p class="mt-2 text-sm text-gray-600">Click to upload or drag and drop</p>
                                <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                            </div>
                            <div id="imagePreviewContainer" class="hidden">
                                <img id="imagePreview" class="image-preview mx-auto rounded-lg" alt="Plant preview">
                                <p class="mt-2 text-sm text-green-600">‚úì Photo uploaded! Click to change</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Step 2: Choose Personality -->
                <div>
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">üé≠ Step 2: Choose a Personality</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="personality-card border-2 border-gray-200 rounded-xl p-4 text-center" data-personality="sassy">
                            <div class="text-4xl mb-2">üò§</div>
                            <h4 class="font-semibold text-gray-800">Sassy</h4>
                            <p class="text-sm text-gray-600 mt-1">Direct & demanding</p>
                        </div>
                        <div class="personality-card border-2 border-gray-200 rounded-xl p-4 text-center" data-personality="zen">
                            <div class="text-4xl mb-2">üßò</div>
                            <h4 class="font-semibold text-gray-800">Zen</h4>
                            <p class="text-sm text-gray-600 mt-1">Peaceful & calm</p>
                        </div>
                        <div class="personality-card border-2 border-gray-200 rounded-xl p-4 text-center" data-personality="anxious">
                            <div class="text-4xl mb-2">üò∞</div>
                            <h4 class="font-semibold text-gray-800">Anxious</h4>
                            <p class="text-sm text-gray-600 mt-1">Worried & nervous</p>
                        </div>
                        <div class="personality-card border-2 border-gray-200 rounded-xl p-4 text-center" data-personality="formal">
                            <div class="text-4xl mb-2">üé©</div>
                            <h4 class="font-semibold text-gray-800">Formal</h4>
                            <p class="text-sm text-gray-600 mt-1">Proper & polite</p>
                        </div>
                    </div>
                    <input type="hidden" id="selectedPersonality" name="personality" required>
                </div>

                <!-- Step 3: Add Nickname (Optional) -->
                <div>
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">‚ú® Step 3: Add a Nickname (Optional)</h3>
                    <input 
                        type="text" 
                        id="plantNickname" 
                        name="nickname"
                        placeholder="e.g., Leafy, Mr. Green, Plantina..."
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none"
                    >
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button 
                        type="submit" 
                        id="submitBtn"
                        class="gradient-bg text-white px-8 py-4 rounded-xl font-semibold text-lg hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        üå± Generate PlantSona
                    </button>
                </div>
            </form>

            <!-- Loading State -->
            <div id="loadingState" class="hidden text-center py-12">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600">Analyzing your plant and creating its personality...</p>
            </div>

            <!-- Results -->
            <div id="results" class="hidden mt-8 space-y-6">
                <div class="bg-green-50 border-2 border-green-200 rounded-xl p-6">
                    <h3 class="text-2xl font-bold text-green-800 mb-4">Meet Your PlantSona! üéâ</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-gray-700">Species Identified:</h4>
                            <p id="resultSpecies" class="text-lg text-gray-800"></p>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-700">Your Plant Says:</h4>
                            <div id="resultVoiceMessage" class="bg-white p-4 rounded-lg text-gray-800 italic"></div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-700">Care Instructions:</h4>
                            <div id="resultCareInstructions" class="bg-white p-4 rounded-lg text-gray-800"></div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-700">Fun Facts:</h4>
                            <div id="resultFunFacts" class="bg-white p-4 rounded-lg text-gray-800"></div>
                        </div>
                    </div>

                    <button 
                        onclick="resetForm()" 
                        class="mt-6 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition"
                    >
                        Create Another PlantSona
                    </button>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden mt-8">
                <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-red-800 mb-2">Oops! Something went wrong</h3>
                    <p id="errorMessage" class="text-red-600"></p>
                    <button 
                        onclick="resetForm()" 
                        class="mt-4 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition"
                    >
                        Try Again
                    </button>
                </div>
            </div>
        </div>

        <!-- Tips Section -->
        <div class="max-w-4xl mx-auto mt-12 bg-blue-50 rounded-2xl p-8">
            <h3 class="text-2xl font-bold text-blue-900 mb-4">üí° Tips for Best Results</h3>
            <ul class="space-y-2 text-blue-800">
                <li>‚úì <strong>Clear Photos:</strong> Use well-lit photos that clearly show the leaves and overall plant structure</li>
                <li>‚úì <strong>Multiple Plants:</strong> If your photo contains multiple plants, our AI will identify the most prominent one</li>
                <li>‚úì <strong>Rare Species:</strong> While we can identify many common houseplants, very rare species may not be recognized correctly</li>
                <li>‚úì <strong>Care Adaptation:</strong> The personality-driven care instructions maintain scientific accuracy despite their stylistic differences</li>
            </ul>
        </div>
    </main>

    <script>
        let selectedPersonality = null;
        let imageBase64 = null;

        // Handle image upload
        document.getElementById('plantImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageBase64 = e.target.result;
                    document.getElementById('imagePreview').src = imageBase64;
                    document.getElementById('uploadPrompt').classList.add('hidden');
                    document.getElementById('imagePreviewContainer').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle personality selection
        document.querySelectorAll('.personality-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.personality-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedPersonality = this.dataset.personality;
                document.getElementById('selectedPersonality').value = selectedPersonality;
            });
        });

        // Handle form submission
        document.getElementById('plantsonaForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!imageBase64) {
                alert('Please upload a plant photo');
                return;
            }

            if (!selectedPersonality) {
                alert('Please select a personality');
                return;
            }

            const nickname = document.getElementById('plantNickname').value;

            // Show loading state
            document.getElementById('plantsonaForm').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');

            try {
                const response = await fetch('/.netlify/functions/plantsona', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        image: imageBase64,
                        personality: selectedPersonality,
                        nickname: nickname
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to generate PlantSona');
                }

                // Show results
                document.getElementById('resultSpecies').textContent = data.plantsona.species;
                document.getElementById('resultVoiceMessage').textContent = data.plantsona.voiceMessage;
                document.getElementById('resultCareInstructions').innerHTML = data.plantsona.careInstructions.replace(/\n/g, '<br>');
                document.getElementById('resultFunFacts').innerHTML = data.plantsona.funFacts.replace(/\n/g, '<br>');

                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').textContent = error.message;
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
            }
        });

        function resetForm() {
            document.getElementById('plantsonaForm').reset();
            document.getElementById('plantsonaForm').classList.remove('hidden');
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('uploadPrompt').classList.remove('hidden');
            document.getElementById('imagePreviewContainer').classList.add('hidden');
            document.querySelectorAll('.personality-card').forEach(c => c.classList.remove('selected'));
            selectedPersonality = null;
            imageBase64 = null;
        }
    </script>
</body>
</html>
